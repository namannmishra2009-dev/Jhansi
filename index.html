<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>For You ‚Äî My Love</title>
  <style>
    :root{
      --bg1:#FFDEE9; --bg2:#B5FFFC; --accent:#ff6b9a; --muted:#666; --glass: rgba(255,255,255,0.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#222}
    .page{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:28px}
    .topbar{width:100%;max-width:980px;display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .names{font-size:14px;color:var(--muted);display:flex;gap:12px;align-items:center}
    .icon-btn{background:none;border:0;font-size:22px;cursor:pointer;padding:8px;border-radius:8px}
    .card{width:100%;max-width:980px;display:grid;grid-template-columns:1fr 1.1fr;gap:22px;background:linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.9));box-shadow:0 12px 40px rgba(0,0,0,0.12);border-radius:14px;padding:22px}
    .left{display:flex;flex-direction:column;gap:14px;align-items:center}
    .photo{width:100%;height:270px;background:linear-gradient(135deg,#fff,rgba(255,255,255,0.7));border-radius:12px;display:flex;align-items:center;justify-content:center;color:#888;text-align:center;padding:10px;cursor:pointer;position:relative;overflow:hidden;border:2px dashed rgba(0,0,0,0.06)}
    .photo img{width:100%;height:100%;object-fit:cover;display:block}
    .controls{display:flex;gap:10px;width:100%;justify-content:center}
    .cta{background:var(--accent);color:#fff;border:0;padding:12px 18px;border-radius:10px;font-weight:600;cursor:pointer}
    .small{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px 10px;border-radius:8px;cursor:pointer}
    .right{padding:6px 2px;display:flex;flex-direction:column;gap:10px}
    h1{margin:6px 0;font-size:28px;color:#333}
    .message{min-height:220px;background:var(--glass);padding:14px;border-radius:10px;color:#222;line-height:1.6;white-space:pre-wrap;font-size:16px}
    .extras{display:flex;gap:12px;align-items:center;margin-top:6px}
    .toggle{display:flex;gap:8px;align-items:center;font-size:14px;color:var(--muted)}
    .love-line{margin-top:8px;color:var(--muted);font-size:14px}
    #floating-hearts{position:fixed;left:0;top:0;right:0;bottom:0;pointer-events:none;overflow:hidden;z-index:80}
    #confetti{position:fixed;left:0;top:0;width:100%;height:100%;z-index:100;pointer-events:none}
    .floating-heart{font-size:20px;will-change:transform,opacity}
    @media (max-width:820px){.card{grid-template-columns:1fr;padding:18px}.photo{height:220px}}
    /* subtle clickable style for To: name */
    #toName strong{cursor:pointer;text-decoration:underline dotted}
  </style>
</head>
<body>
  <div class="page">
    <header class="topbar">
      <div class="names">
        <span id="fromName">From: Namann</span>
        <span id="toName">To: <strong>[Her Name]</strong></span>
      </div>
      <button id="heartBtn" class="icon-btn" title="Send a heart">üíñ</button>
    </header>

    <main class="card">
      <div class="left">
        <div class="photo" id="photoPlaceholder" title="Click to add a photo">
          <span>Click to add a photo</span>
        </div>
        <div class="controls">
          <button id="openBtn" class="cta">Open Your Letter</button>
          <button id="replayBtn" class="small">Replay</button>
        </div>
      </div>

      <div class="right">
        <h1 id="title">To my future wife</h1>

        <div id="message" class="message"><!-- typed message will appear here --></div>

        <div class="extras">
          <button id="confettiBtn" class="small">Make It Rain Confetti üéâ</button>
          <label class="small toggle">
            <input id="musicToggle" type="checkbox" /> Play music
          </label>
        </div>

        <footer class="love-line">
          <span id="signature">With all my heart, Namann ‚ù§Ô∏è</span>
        </footer>
      </div>
    </main>

    <canvas id="confetti"></canvas>
    <div id="floating-hearts"></div>

    <!-- Place your copy of the song (jeene_laga_hun.mp3) in the same folder for playback -->
    <audio id="bgMusic" loop preload="auto" style="display:none">
      <source src="jeene_laga_hun.mp3" type="audio/mpeg" />
    </audio>

    <script>
      // single-file JS (no external files)
      const messageTemplate = [
        "My dearest %%NAME%%,",
        "",
        "Every day I find a new reason to love you. Your laugh, the way you think, the warmth of your hand ‚Äî they make every ordinary moment feel like a beautiful memory.",
        "",
        "I promise to listen, to hold you close in storms and sunshine, to cheer for your dreams and build ours together.",
        "",
        "Forever isn't long enough with you.",
        "",
        "Always yours,",
        "Namann ‚ù§Ô∏è"
      ].join("\\n");

      const messageEl = document.getElementById('message');
      const openBtn = document.getElementById('openBtn');
      const replayBtn = document.getElementById('replayBtn');
      const confettiBtn = document.getElementById('confettiBtn');
      const confettiCanvas = document.getElementById('confetti');
      const heartBtn = document.getElementById('heartBtn');
      const floatingHearts = document.getElementById('floating-hearts');
      const photoPlaceholder = document.getElementById('photoPlaceholder');
      const musicToggle = document.getElementById('musicToggle');
      const bgMusic = document.getElementById('bgMusic');
      const toNameStrong = document.querySelector('#toName strong');

      let typingTimer = null;

      function escapeHtml(s){ return String(s).replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

      function typeMessage(text, el, speed = 24) {
        el.textContent = '';
        let i = 0;
        clearInterval(typingTimer);
        typingTimer = setInterval(() => {
          if (i >= text.length) { clearInterval(typingTimer); return; }
          el.textContent += text[i++];
        }, speed);
      }

      function makeConfetti() {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
        const ctx = confettiCanvas.getContext('2d');
        const pieces = []; const colors = ['#ff7aa2','#ffd166','#9ee493','#8bd3ff','#d6a9ff'];
        for (let i=0;i<120;i++){
          pieces.push({ x: Math.random()*confettiCanvas.width, y: Math.random()*-confettiCanvas.height, w:6+Math.random()*10, h:6+Math.random()*10, vx:-2+Math.random()*4, vy:2+Math.random()*6, r:Math.random()*360, color: colors[Math.floor(Math.random()*colors.length)]});
        }
        let t=0;
        (function draw(){
          ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
          for (let p of pieces){
            p.x += p.vx; p.y += p.vy; p.r += 5;
            ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.r * Math.PI/180);
            ctx.fillStyle = p.color; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore();
            if (p.y > confettiCanvas.height + 50){ p.y = -10 - Math.random()*confettiCanvas.height; p.x = Math.random()*confettiCanvas.width; }
          }
          t++; if (t < 300) requestAnimationFrame(draw); else ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
        })();
      }

      function createHeart(x,y){
        const el = document.createElement('div'); el.className='floating-heart';
        el.style.position='absolute'; el.style.left=(x-12)+'px'; el.style.top=(y-12)+'px'; el.style.pointerEvents='none';
        el.style.fontSize='22px'; el.style.zIndex=90; el.style.opacity=1; el.textContent='üíó';
        floatingHearts.appendChild(el);
        const duration = 3000 + Math.random()*1500; const dx = (Math.random()-0.5)*80;
        el.animate([{transform:`translate(0,0) scale(1)`,opacity:1},{transform:`translate(${dx}px,-140px) scale(1.2)`,opacity:0}],{duration,easing:'ease-out',fill:'forwards'});
        setTimeout(()=>el.remove(), duration+50);
      }

      function burstHearts(count=8,x=null,y=null){
        for (let i=0;i<count;i++){
          const cx = x ?? (window.innerWidth/2 + (Math.random()-0.5)*200);
          const cy = y ?? (window.innerHeight/2 + (Math.random()-0.5)*200);
          setTimeout(()=> createHeart(cx + (Math.random()-0.5)*60, cy + (Math.random()-0.5)*60), i*60);
        }
      }

      photoPlaceholder.addEventListener('click', () => {
        const input = document.createElement('input'); input.type='file'; input.accept='image/*';
        input.onchange = () => {
          const file = input.files[0]; if (!file) return;
          const reader = new FileReader();
          reader.onload = () => { photoPlaceholder.innerHTML=''; const img=document.createElement('img'); img.src=reader.result; photoPlaceholder.appendChild(img); };
          reader.readAsDataURL(file);
        };
        input.click();
      });

      function getRecipientName(){ try{ const t = toNameStrong.textContent.trim(); return t?escapeHtml(t):'[Her Name]'; }catch(e){return'[Her Name]';} }

      openBtn.addEventListener('click', () => {
        const recipient = getRecipientName();
        const finalMessage = messageTemplate.replace(/%%NAME%%/g, recipient);
        typeMessage(finalMessage, messageEl, 18);
        makeConfetti(); burstHearts(12);
        if (musicToggle.checked) bgMusic.play().catch(()=>{});
      });

      replayBtn.addEventListener('click', () => {
        const recipient = getRecipientName();
        const finalMessage = messageTemplate.replace(/%%NAME%%/g, recipient);
        typeMessage(finalMessage, messageEl, 12); burstHearts(8);
      });

      confettiBtn.addEventListener('click', makeConfetti);
      heartBtn.addEventListener('click', (e)=>{ const r = heartBtn.getBoundingClientRect(); burstHearts(6, r.left+r.width/2, r.top+r.height/2); });

      document.addEventListener('click', (ev) => {
        const tag = ev.target && ev.target.tagName ? ev.target.tagName.toLowerCase() : '';
        if (['button','input','img','strong'].includes(tag)) return;
        createHeart(ev.clientX, ev.clientY);
      });

      musicToggle.addEventListener('change', ()=>{ if (musicToggle.checked) bgMusic.play().catch(()=>{}); else bgMusic.pause(); });

      // allow clicking the To: name to set it (user gesture) and persist
      toNameStrong.addEventListener('click', ()=> {
        const prev = toNameStrong.textContent.replace(/\[|\]/g,'').trim();
        const v = prompt("Enter your name:", prev==='Her Name' ? '' : prev);
        if (v !== null){
          const safe = v.trim() || '[Her Name]';
          toNameStrong.textContent = safe;
          try { localStorage.setItem('recipientName', safe); } catch(e){}
          burstHearts(10);
          // attempt to play music because this is a user gesture
          musicToggle.checked = true; bgMusic.play().catch(()=>{});
        }
      });

      // restore name if stored
      window.addEventListener('load', ()=> {
        try {
          const stored = localStorage.getItem('recipientName');
          if (stored) toNameStrong.textContent = stored;
        } catch(e){}
        setTimeout(()=> typeMessage('Click "Open Your Letter" to see a special message ‚ù§', messageEl, 30), 700);
      });

      window.addEventListener('resize', ()=>{ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; });
    </script>
  </div>
</body>
</html>
